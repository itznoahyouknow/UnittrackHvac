<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UnitTrack HVAC - Login</title>
    <!-- W3.CSS Integration -->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="icon" href="favicon.ico" type="image/x-icon">


    <style>
        :root {
            --system-ui: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', sans-serif;
            --primary-color: #2997ff;
            --primary-hover: #0077ed;
            --text-color: #f5f5f7;
            --text-secondary: #86868b;
            --bg-dark: #000;
            --bg-card: #1d1d1f;
            --swiftui-gradient: linear-gradient(135deg, #2997FF, #007AFF);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        body {
            font-family: var(--system-ui);
            background: var(--bg-dark);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .login-container {
            background: rgba(29, 29, 31, 0.8);
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 420px;
            margin: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            z-index: 10;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            animation: containerFadeIn 0.6s ease-out;
        }

        @keyframes containerFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
            animation: headerSlideDown 0.5s ease-out;
        }

        @keyframes headerSlideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .login-header h1 {
            font-size: 28px;
            margin-top: 15px;
            background: var(--swiftui-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 24px;
            animation: formSlideUp 0.5s ease-out;
        }

        @keyframes formSlideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: var(--text-color);
            font-weight: 500;
            font-size: 15px;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: var(--text-color);
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(41, 151, 255, 0.2);
        }

        .login-button {
            width: 100%;
            padding: 14px;
            background: var(--swiftui-gradient);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(41, 151, 255, 0.2);
        }

        .login-button:active {
            transform: translateY(0);
        }

        .ios-link {
            display: inline-block;
            margin-top: 20px;
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .ios-link:hover {
            color: var(--primary-hover);
            transform: translateX(5px);
        }

        /* Enhanced background effects */
        .background {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #1c1c1e 0%, #0a0a0a 100%);
            z-index: 1;
            top: 0;
            left: 0;
        }

        .glass-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.02) 0%,
                rgba(255, 255, 255, 0.01) 100%
            );
            backdrop-filter: blur(30px);
            z-index: 2;
        }

        /* SwiftUI-style small text */
        .swift-caption {
            font-size: 19px;
            color: var(--text-secondary);
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Responsive adjustments */
        @media (max-width: 480px) {
            .login-container {
                margin: 10px;
                padding: 30px;
            }

            .login-header h1 {
                font-size: 24px;
            }
        }

        .stat-display {
            margin-top: 12px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            animation: statFadeIn 0.6s ease-out;
        }

        @keyframes statFadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #timeDisplay {
            color: var(--primary-color);
            font-size: 14px;
            font-weight: 500;
        }

        #dateDisplay {
            margin-top: 2px;
        }
    </style>
</head>
<body>
    <script>
        // Create background and overlay elements
        const background = document.createElement('div');
        background.className = 'background';
        const glassOverlay = document.createElement('div'); 
        glassOverlay.className = 'glass-overlay';
        background.appendChild(glassOverlay);
        document.body.appendChild(background);

        // Create main login container
        const loginContainer = document.createElement('div');
        loginContainer.className = 'login-container w3-animate-opacity';

        // Create login header
        const loginHeader = document.createElement('div');
        loginHeader.className = 'login-header';

        const snowflakeIcon = document.createElement('i');
        snowflakeIcon.className = 'fas fa-snowflake fa-2x';
        snowflakeIcon.style.color = 'var(--primary-color)';

        const title = document.createElement('h1');
        title.textContent = 'UnitTrack HVAC';

        const statDisplay = document.createElement('div');
        statDisplay.className = 'stat-display';

        const welcomeMsg = document.createElement('div');
        welcomeMsg.className = 'swift-caption';
        welcomeMsg.id = 'welcomeMessage';

        const timeDisplay = document.createElement('div');
        timeDisplay.className = 'swift-caption';
        timeDisplay.id = 'timeDisplay';

        const dateDisplay = document.createElement('div');
        dateDisplay.className = 'swift-caption';
        dateDisplay.id = 'dateDisplay';

        statDisplay.append(welcomeMsg, timeDisplay, dateDisplay);
        loginHeader.append(snowflakeIcon, title, statDisplay);

        // Create login form
        const form = document.createElement('form');
        form.id = 'loginForm';
        form.onsubmit = (e) => handleLogin(e);

        // PIN input group
        const pinGroup = document.createElement('div');
        pinGroup.className = 'form-group';
        
        const pinLabel = document.createElement('label');
        pinLabel.htmlFor = 'pin';
        pinLabel.textContent = 'Enter PIN';

        const pinInput = document.createElement('input');
        pinInput.type = 'password';
        pinInput.id = 'pin';
        pinInput.name = 'pin';
        pinInput.placeholder = 'Enter your PIN number';
        pinInput.required = true;

        const tempPin = document.createElement('div');
        tempPin.className = 'swift-caption';
        tempPin.id = 'tempPin';

        pinGroup.append(pinLabel, pinInput, tempPin);

        // Name input group
        const nameGroup = document.createElement('div');
        nameGroup.className = 'form-group';
        nameGroup.id = 'nameInputGroup';

        const nameLabel = document.createElement('label');
        nameLabel.htmlFor = 'name';
        nameLabel.textContent = 'Enter Name';

        const nameInput = document.createElement('input');
        nameInput.type = 'text';
        nameInput.id = 'name';
        nameInput.name = 'name';
        nameInput.placeholder = 'Enter your name';

        nameGroup.append(nameLabel, nameInput);

        // Location select group
        const locationGroup = document.createElement('div');
        locationGroup.className = 'form-group';

        const locationLabel = document.createElement('label');
        locationLabel.htmlFor = 'location';
        locationLabel.textContent = 'Select Location';

        const locationSelect = document.createElement('select');
        locationSelect.id = 'location';
        locationSelect.name = 'location';
        locationSelect.className = 'w3-select';

        const locations = ['Hickman', 'Yamato', 'Big River Steel'];
        locations.forEach(loc => {
            const option = document.createElement('option');
            option.value = loc.toLowerCase();
            option.textContent = loc;
            locationSelect.appendChild(option);
        });

        locationGroup.append(locationLabel, locationSelect);

        // Submit button
        const submitBtn = document.createElement('button');
        submitBtn.type = 'submit';
        submitBtn.className = 'login-button w3-ripple';
        submitBtn.textContent = 'Login';

        // App availability message
        const appMsg = document.createElement('div');
        appMsg.className = 'swift-caption';
        appMsg.style.cssText = 'text-align: center; margin-top: 20px;';
        appMsg.textContent = 'This service will be available on iOS & Android';

        // iOS app link
        const iosLink = document.createElement('a');
        iosLink.href = 'AppleApp.html';
        iosLink.className = 'ios-link';

        const appleIcon = document.createElement('i');
        appleIcon.className = 'fab fa-apple';
        iosLink.append(appleIcon, ' Learn about the UnitTrack iOS App');

        // Copyright message
        const copyright = document.createElement('div');
        copyright.className = 'swift-caption';
        copyright.style.cssText = 'text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);';
        copyright.textContent = '© 2024 UnitTrack HVAC. All rights reserved.';

        // Assemble form
        form.append(pinGroup, nameGroup, locationGroup, submitBtn, appMsg, iosLink, copyright);

        // Put it all together
        loginContainer.append(loginHeader, form);
        document.body.appendChild(loginContainer);
    </script>

    <script>
        // Generate random PIN
        const randomPin = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('tempPin').textContent = `Temporary PIN: ${randomPin}`;
        
        // Check for saved name and location when page loads
        document.addEventListener('DOMContentLoaded', function() {
            const savedName = localStorage.getItem('userName');
            const savedLocation = localStorage.getItem('selectedLocation');
            const nameInputGroup = document.getElementById('nameInputGroup');
            const nameInput = document.getElementById('name');
            
            if (savedName) {
                // Remove the name input group completely if we have a saved name
                nameInputGroup.remove();
                document.getElementById('welcomeMessage').textContent = `Welcome back, ${savedName}!`;
                
                // Set last used location if available
                if (savedLocation) {
                    document.getElementById('location').value = savedLocation;
                }
            } else {
                // Only add required attribute if there's no saved name
                nameInput.setAttribute('required', 'required');
            }
        });

        function handleLogin(event) {
            event.preventDefault();
            const pin = document.getElementById('pin').value;
            const location = document.getElementById('location').value;
            const savedName = localStorage.getItem('userName');
            const nameInput = document.getElementById('name');
            
            // Get name from localStorage if it exists, otherwise from input
            const name = savedName || (nameInput ? nameInput.value.trim() : '');
            
            if (!savedName && (!nameInput || !name)) {
                alert('Please enter your name');
                return;
            }
            
            if (pin === randomPin) {
                // Only save name if it's not already saved
                if (!savedName && name) {
                    localStorage.setItem('userName', name);
                }
                
                // Save selected location
                localStorage.setItem('selectedLocation', location);
                
                // Redirect based on location
                switch(location.toLowerCase()) {
                    case 'hickman':
                        window.location.href = 'unittrack-hickman.html';
                        break;
                    case 'yamato': 
                        window.location.href = 'unittrack-yamato.html';
                        break;
                    case 'big river steel':
                        window.location.href = 'unittrack-bigriversteel.html';
                        break;
                    default:
                        window.location.href = 'unittrack-hickman.html';
                }
            } else {
                // SwiftUI-style error animation
                const form = document.getElementById('loginForm');
                form.classList.add('w3-animate-shake');
                setTimeout(() => form.classList.remove('w3-animate-shake'), 500);
                
                alert('Invalid PIN. Please try again.');
            }
        }

        function updateDateTime() {
            const now = new Date();
            
            // Format time
            const timeOptions = { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit', 
                hour12: true 
            };
            const timeStr = now.toLocaleTimeString('en-US', timeOptions);
            
            // Format date
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            };
            const dateStr = now.toLocaleDateString('en-US', dateOptions);
            
            document.getElementById('timeDisplay').textContent = timeStr;
            document.getElementById('dateDisplay').textContent = dateStr;
        }

        // Update immediately and then every second
        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>
    <script>
        function logLogin(userName) {
            const now = new Date();
            const timestamp = now.toISOString();
            const date = now.toLocaleDateString();
            const time = now.toLocaleTimeString();
            
            // Create CSV row
            const logData = `${userName},${date},${time},${timestamp}\n`;
            
            // Use Netlify function instead of PHP
            fetch('/.netlify/functions/log-login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'text/plain',
                },
                body: logData
            })
            .catch(error => console.error('Error logging login:', error));
        }

        // Add login logging to existing login validation
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const userName = document.getElementById('userName').value;
            const pin = document.getElementById('pin').value;

            if (validatePin(pin)) {
                // Log the successful login
                logLogin(userName);
                
                // Rest of existing login logic continues...
            }
        });
    </script>
</body>
</html>